<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCC Department Center: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ========================================================================= */
/* --- CSS STYLES (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î) --- */
/* ========================================================================= */
body {
    font-family: 'Sarabun', sans-serif;
    background-color: #f4f7f6;
    color: #333;
    padding: 20px;
}

h2 {
    color: #4a148c; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
    border-bottom: 3px solid #e0e0e0;
    padding-bottom: 10px;
    margin-top: 30px;
}

.form-section, .indicator-dashboard {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

button {
    padding: 8px 12px;
    margin-top: 10px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    font-size: 14px;
    color: white;
    background-color: #2196f3;
    margin-right: 5px;
}
button:hover {
    opacity: 0.9;
}


/* === 1. ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å === */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 14px;
}

th, td {
    border: 1px solid #ddd;
    padding: 10px 8px;
    text-align: left;
    vertical-align: middle;
}

th {
    background-color: #bbdefb; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
    color: #1a237e; /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° */
    font-weight: bold;
    text-align: center;
}
td:last-child {
    text-align: center;
}

/* === 2. ‡∏™‡πÑ‡∏ï‡∏•‡πå Progress Bar === */
.progress-bar-container {
    background-color: #eee;
    border-radius: 5px;
    overflow: hidden;
    height: 25px;
    width: 100%;
}

.progress-bar {
    background-color: #4CAF50; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    color: white;
    height: 100%;
    text-align: right;
    padding-right: 5px;
    line-height: 25px; /* ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ñ‡∏ö */
    transition: width 0.5s ease;
    font-weight: bold;
}

/* === 3. ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Days Left) === */
.status-due {
    background-color: #ffcdd2; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏≠‡πà‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô */
    color: #b71c1c; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
    font-weight: bold;
    padding: 3px 5px;
    border-radius: 3px;
}
.status-ok {
    background-color: #e8f5e9; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô */
    color: #388e3c; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏° */
    font-weight: bold;
    padding: 3px 5px;
    border-radius: 3px;
}
</style>
</head>
<body onload="loadIndicators()">
    
    <div class="form-section" id="indicatorSetupForm">
        <h2>üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà</h2>
        
        <label for="indicatorName">‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î:</label>
        <input type="text" id="indicatorName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£" required><br><br>

        <label for="indicatorTarget">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç):</label>
        <input type="number" id="indicatorTarget" min="0" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100 ‡∏´‡∏£‡∏∑‡∏≠ 5000" required><br><br>

        <label for="indicatorType">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
        <select id="indicatorType">
            <option value="quantity">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì (KPIs)</option>
            <option value="quality">‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (Milestones)</option>
        </select><br><br>

        <label for="indicatorDueDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á:</label>
        <input type="date" id="indicatorDueDate" required><br><br>

        <button onclick="addIndicator()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î</button>
    </div>

    <hr>

    <div class="indicator-dashboard">
        <h2>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</h2>
        <table>
            <thead>
                <tr>
                    <th>‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î</th>
                    <th>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                    <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</th>
                    <th>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ß‡∏±‡∏ô</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="indicatorTableBody">
                </tbody>
        </table>
    </div>

    <script>
        const INDICATORS_KEY = 'occ_dept_indicators';

        // --- 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Local Storage ---
        function getIndicators() {
            const data = localStorage.getItem(INDICATORS_KEY);
            return data ? JSON.parse(data) : [];
        }

        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏à‡∏≤‡∏Å Form Setup) ---
        function addIndicator() {
            const name = document.getElementById('indicatorName').value;
            const target = parseFloat(document.getElementById('indicatorTarget').value);
            const type = document.getElementById('indicatorType').value;
            const dueDate = document.getElementById('indicatorDueDate').value;

            if (!name || isNaN(target) || !dueDate) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!");
                return;
            }

            const newId = Date.now();

            const newIndicator = {
                id: newId, 
                name: name,
                target: target,
                type: type,
                dueDate: dueDate,
                history: [{ 
                    date: new Date().toLocaleDateString('th-TH'), 
                    actual: 0 
                }] 
            };

            const indicators = getIndicators();
            indicators.push(newIndicator);
            
            // ... ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô function addIndicator()
    // ...
    localStorage.setItem(INDICATORS_KEY, JSON.stringify(indicators));

    alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
    
    loadIndicators(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡πà‡∏≠‡∏ô

    // ‚úÖ Reset Form ‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
    document.getElementById('indicatorName').value = '';
    document.getElementById('indicatorTarget').value = '';
    document.getElementById('indicatorDueDate').value = '';
}

        // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Progress ‡πÅ‡∏•‡∏∞ Trend Display ---
        function calculateProgressDisplay(indicator) {
            const latestActual = indicator.history[indicator.history.length - 1].actual;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
            const due = new Date(indicator.dueDate);
            const today = new Date();
            const diffTime = due - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á Days Left
            let daysLeftDisplay = '';
            let statusClass = '';

            if (diffDays < 0) {
                daysLeftDisplay = '‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡πâ‡∏ß';
                statusClass = 'status-due';
            } else if (diffDays <= 7) {
                daysLeftDisplay = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${diffDays} ‡∏ß‡∏±‡∏ô (‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô)`;
                statusClass = 'status-due';
            } else {
                daysLeftDisplay = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${diffDays} ‡∏ß‡∏±‡∏ô`;
                statusClass = 'status-ok';
            }
            
            let progressPercent = 0;
            let progressColor = '#4CAF50'; 
            let actualDisplay = '';

            if (indicator.type === 'quantity') {
                progressPercent = Math.min(100, Math.round((latestActual / indicator.target) * 100));
                actualDisplay = `${latestActual} / ${indicator.target}`;
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ Progress Bar ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤
                if (progressPercent < 25 && diffDays < 30) {
                    progressColor = '#f44336'; 
                } else if (progressPercent < 50) {
                    progressColor = '#ff9800'; 
                }
                
            } else {
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
                progressPercent = 0; 
                actualDisplay = latestActual; 
            }
            
            return {
                latestActual: actualDisplay,
                progressPercent: progressPercent,
                progressColor: progressColor,
                daysLeft: `<span class="${statusClass}">${daysLeftDisplay}</span>`
            };
        }


        // --- 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á ---
        function loadIndicators() {
            const indicators = getIndicators();
            const tableBody = document.getElementById('indicatorTableBody');
            tableBody.innerHTML = ''; 

            if (indicators.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</td></tr>';
                return;
            }

            indicators.forEach(indicator => {
                const displayData = calculateProgressDisplay(indicator);

                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${indicator.name}</td>
                    <td>${indicator.target} ${indicator.type === 'quantity' ? '‡∏´‡∏ô‡πà‡∏ß‡∏¢' : '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô/‡∏Ñ‡∏£‡∏±‡πâ‡∏á'}</td>
                    <td>${displayData.latestActual}</td>
                    <td>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${displayData.progressPercent}%; background-color: ${displayData.progressColor};">${displayData.progressPercent}%</div>
                        </div>
                    </td>
                    <td>${displayData.daysLeft}</td>
                    <td>
                        <button onclick="showUpdateForm(${indicator.id})">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</button>
                        <button onclick="deleteIndicator(${indicator.id})" style="background-color: #f44336;">‡∏•‡∏ö</button>
                    </td>
                `;
            });
        }


        // --- 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Form ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Actual Value) ---
        function showUpdateForm(id) {
            const indicators = getIndicators();
            const indicator = indicators.find(i => i.id === id);
            if (!indicator) return;

            let updatePrompt = '';
            let initialValue = indicator.history[indicator.history.length - 1].actual;

            if (indicator.type === 'quantity') {
                updatePrompt = `‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ Actual (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "${indicator.name}" (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${indicator.target}):`;
            } else {
                updatePrompt = `‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ Actual ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "${indicator.name}" (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß 5/10', '‡∏ú‡πà‡∏≤‡∏ô')`;
            }

            const newValue = prompt(updatePrompt, initialValue);

            if (newValue !== null) {
                updateIndicatorActual(id, newValue);
            }
        }

        // --- 6. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Actual Value ‡∏•‡∏á‡πÉ‡∏ô History ---
        function updateIndicatorActual(id, newValue) {
            const indicators = getIndicators();
            const indicatorIndex = indicators.findIndex(i => i.id === id);

            if (indicatorIndex !== -1) {
                const indicator = indicators[indicatorIndex];
                const floatValue = parseFloat(newValue);
                
                let actualData;

                if (indicator.type === 'quantity' && !isNaN(floatValue)) {
                    actualData = floatValue;
                } 
                else if (indicator.type === 'quality') {
                    actualData = isNaN(floatValue) ? newValue.trim() : floatValue;
                } else {
                    alert("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì");
                    return;
                }
                
                indicator.history.push({ 
                    date: new Date().toLocaleDateString('th-TH'), 
                    actual: actualData 
                });
                
                localStorage.setItem(INDICATORS_KEY, JSON.stringify(indicators));
                loadIndicators();
            }
        }

        // --- 7. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î ---
        function deleteIndicator(id) {
            if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ô‡∏µ‡πâ? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ")) {
                let indicators = getIndicators();
                indicators = indicators.filter(i => i.id !== id);
                localStorage.setItem(INDICATORS_KEY, JSON.stringify(indicators));
                loadIndicators();
            }
        }
    </script>
</body>
</html>
